<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sorry I'm Busy</title>

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  font-family:Helvetica, Arial, sans-serif;
}
#scene{
  width:100vw;
  height:100vh;
  object-fit:cover;
}
#score{
  position:absolute;
  top:20px;
  left:20px;
  color:white;
  font-size:20px;
}
</style>
</head>

<body>

<div id="score">Score: 10</div>
<img id="scene" src="SubwayEntrance.png">

<script>
let score = 10;
let sceneIndex = 0;

const scene = document.getElementById("scene");
const scoreText = document.getElementById("score");

function updateScore(){
  scoreText.innerText = "Score: " + score;
}

// 씬 정의 (네 시나리오 그대로 수학 적용)
const scenes = [

  // Scene 0: Subway Entrance
  {
    img:"SubwayEntrance.png",
    left: () => { score -=1; sceneIndex = 1; },   // 이메일 확인
    right:() => { sceneIndex = 2; }               // 자전거 선택
  },

  // Scene 1: On Subway Seat
  {
    img:"OnTheSubwaySeat.png",
    left: () => { score -=1; sceneIndex = 4; },   // 폰 확인
    right:() => { sceneIndex = 4; }               // 폰 안보기
  },

  // Scene 2: Before Riding Bike → Riding Bike
  {
    img:"RidingTheBikeNiceView.png",
    left: () => { score +=1; sceneIndex = 4; },   // 음악 듣기
    right:() => { score +=2; sceneIndex = 4; }    // 도시 소리 듣기
  },

  // Scene 3 (unused placeholder)
  {},

  // Scene 4: Near Home Street (마지막 선택 전)
  {
    img:"NearHomeStreet.png",
    left: () => { score -=2; sceneIndex = 5; },   // 지금 메시지 확인
    right:() => { score +=2; sceneIndex = 5; }    // 폰 잠그기
  },

  // Scene 5: LAST → 엔딩 계산
  {
    img:"LAST.png",
    left:null,
    right:null
  }
];

function renderScene(){
  const s = scenes[sceneIndex];
  scene.src = s.img;
  updateScore();

  // LAST 씬이면 자동 엔딩 계산
  if(sceneIndex === 5){
    setTimeout(showEnding, 3000);
  }
}

function showEnding(){
  let gender = Math.random() < 0.5 ? "male" : "female";

  if(score >= 12){
    scene.src = "fresh_" + gender + ".png";
  }
  else if(score >= 7){
    scene.src = "burning_" + gender + ".png";
  }
  else{
    scene.src = "burned_" + gender + ".png";
  }

  updateScore();
}

// 화면 터치 좌우 감지
document.addEventListener("click", function(e){
  if(sceneIndex === 5) return;

  let x = e.clientX;
  let mid = window.innerWidth / 2;

  if(x < mid){
    // 왼쪽 터치
    scenes[sceneIndex].left();
  }else{
    // 오른쪽 터치
    scenes[sceneIndex].right();
  }

  renderScene();
});

// 시작 렌더
renderScene();
</script>

</body>
</html>
